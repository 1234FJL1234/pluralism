<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>工作详情</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8" />
    <meta name="keywords" content="" />
    <script>
        addEventListener("load", function () {
            setTimeout(hideURLbar, 0);
        }, false);

        function hideURLbar() {
            window.scrollTo(0, 1);
        }
    </script>
    <!-- Custom Theme files -->
    <link href="css/bootstrap.min.css" type="text/css" rel="stylesheet" media="all">
    <link href="css/style.css" type="text/css" rel="stylesheet" media="all">
    <!-- font-awesome icons -->
    <link href="css/font-awesome.min.css" rel="stylesheet">
    <!-- //Custom Theme files -->
    <!-- online-sfonts -->
    <link href="http://fonts.googleapis.com/css?family=Source+Sans+Pro:200,200i,300,300i,400,400i,600,600i,700,700i,900,900i"
        rel="stylesheet">
</head>

<body>
    <!-- header -->
    <header>
        <div class="container">
            <nav class="navbar navbar-expand-lg navbar-light p-0">
                <h1><a class="navbar-brand" href=" ">教师信息管理中心</a></h1>
                <button class="navbar-toggler ml-lg-auto ml-sm-5 bg-light" type="button" data-toggle="collapse"
                    data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                    aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="ml-lg-5 navbar-nav mr-lg-auto">
                        <li class="nav-item active mr-lg-4 mt-lg-0 mt-sm-4 mt-3">
                            <a th:href="@{~/index}">首页</a>
                        </li>
                        <li class="nav-item mr-lg-4 mt-lg-0 mt-sm-4 mt-3">
                            <a th:href="@{~/jobList}">工作列表</a>
                        </li>
                        <li class="nav-item mr-lg-4 mt-lg-0 mt-sm-4 mt-3" th:if="${session.user} and ${session.user.roleType} eq 2">
                            <a th:href="@{~/studentList}">人才中心</a>
                        </li>
                        <li class="nav-item  mr-lg-4 mt-lg-0 mt-sm-4 mt-3">
                            <a th:href="@{~/about}">勤工通告</a>
                        </li>
                        <li class="nav-item mr-lg-4 my-lg-0 mb-sm-4 mb-3">
                            <a th:href="@{~/contact}">兼职须知</a>
                        </li>
                    </ul>
                    <button type="button" class="btn w3ls-btn text-uppercase font-weight-bold d-block" data-toggle="modal"
                            aria-pressed="false" data-target="#exampleModal1" th:unless="${session.user}">
                        注册
                    </button>
                    <button type="button" class="btn w3ls-btn ml-lg-1 text-uppercase font-weight-bold d-block"
                            data-toggle="modal" aria-pressed="false" data-target="#exampleModal" th:unless="${session.user}">
                        登录
                    </button>
                    <button type="button" class="btn w3ls-btn ml-lg-1 text-uppercase font-weight-bold d-block"
                            th:if="${session.user}" th:text="${session.user.userName}" id="userInfo">
                    </button>
                    <p hidden="hidden" th:if="${session.user}" th:text="${session.user.userId}" id="userId"></p>
                    <p hidden="hidden" th:if="${session.user}" th:text="${session.user.roleType}" id="roleType"></p>
                    <button type="button" class="btn w3ls-btn ml-lg-1 text-uppercase font-weight-bold d-block"
                            data-toggle="modal" aria-pressed="false" data-target="#userInfoModal" th:if="${session.user}" id="exit">退出系统
                    </button>
                </div>
            </nav>
        </div>
    </header>
    <!-- //header -->
    <div class="inner-banner-w3ls">
    </div>
    <!-- jobs -->
    <section class="employ-sec">
        <div class="container">
            <div class="row pt-lg-5">
                <div class="col-lg-12" id="detailJobTest">

                </div>
                <div class="col-lg-12" id="application">

                </div>
            </div>
        </div>
    </section>
    <!-- //jobs -->
    <!-- Footer -->
    <footer id="footer" class="py-sm-5 py-4 bg-theme">
        <div class="container">
            <div class="footer-top-w3ls">
                <h2><a href="index.html" class="navbar-brand">大学生勤工俭学网</a></h2>
                <p class="text-white">为了改变目前大学生普遍存在的、不能方便有效地找到适合自己的兼职工作现状，
                    并且同时满足在校求职者和招聘单位双向的需求，大学生勤工俭学平台收集大量招聘单位的招聘信息，
                    并且展示了在校求职者的相关求职信息，使用人单位和校园求职者之间的交流更加及时和方便。
                    该平台的建立旨在显著地提高学生寻找勤工俭学工作的效率，并且大幅度地减轻高校学生管理者的工作负担。</p>
            </div>
        </div>
    </footer>
    <!-- /Footer -->
    <div class="cpy-right text-center py-4">
        <p class="text-dark">Copyright &copy; 2018.Company name All rights reserved.<a target="_blank" href="#">文一舟</a>
        </p>
    </div>
    <!-- login modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
         aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header bg-theme1">
                    <h5 class="modal-title" id="exampleModalLabel">登录</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <!--<form action="" th:action="@{~/user/login}" method="post" class="p-3">-->
                    <form method="post" class="p-3">
                        <div class="form-group">
                            <label for="userPhone" class="col-form-label">手机号</label>
                            <input type="text" class="form-control" placeholder=" " name="userName" id="userPhone"
                                   required="">
                        </div>
                        <div class="form-group">
                            <label for="userPassword" class="col-form-label">密码</label>
                            <input type="password" class="form-control" placeholder=" " name="userPassword" id="userPassword"
                                   required="">
                        </div>
                        <div class="right-w3l">
                            <input type="submit" class="form-control bg-theme" value="Login" id="login">
                        </div>
                        <div class="row sub-w3l my-3">
                            <div class="col sub-w3ltd">
                                <input type="checkbox" id="brand1" value="">
                                <label for="brand1" class="text-dark">
                                    <span></span>记住密码?</label>
                            </div>
                            <div class="col forgot-w3l text-right">
                                <a href="#" class="text-dark">忘记密码?</a>
                            </div>
                        </div>
                        <p class="text-center dont-do">没有账号?
                            <a href="#" data-toggle="modal" data-target="#exampleModal1" class="text-dark">
                                <strong>点击注册</strong></a>
                        </p>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- //login modal -->
    <!-- register modal -->
    <div class="modal fade" id="exampleModal1" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel1"
         aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header bg-theme1">
                    <h5 class="modal-title" id="exampleModalLabel1">注册</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <!--th:action="@{~/register}"-->
                    <form action="#"  method="post" class="p-3" enctype="application/x-www-form-urlencoded">
                        <div class="form-group">
                            <label for="userName" class="col-form-label">用户名</label>
                            <input type="text" class="form-control" placeholder="" name="userName" id="userName"
                                   required="">
                        </div>
                        <div class="form-group">
                            <label for="recipient-email" class="col-form-label">邮箱</label>
                            <input type="email" class="form-control" placeholder="" name="userEmail" id="recipient-email"
                                   required="">
                        </div>
                        <div class="form-group">
                            <label for="recipient-phone" class="col-form-label">手机号</label>
                            <input type="text" class="form-control" placeholder="" name="userPhone" id="recipient-phone"
                                   required="">
                        </div>
                        <div class="form-group">
                            <label for="password1" class="col-form-label">密码</label>
                            <input type="password" class="form-control" placeholder="" name="userPassword" id="password1"
                                   required="">
                        </div>
                        <div class="form-group">
                            <label for="password2" class="col-form-label">重复密码</label>
                            <input type="password" class="form-control" placeholder="" name="Confirm Password" id="password2"
                                   required="">
                        </div>
                        <div class="right-w3l">
                            <input type="submit" class="form-control bg-theme" value="Register" id="register">
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- //register modal -->
    <!-- sjs -->
    <script src="js/jquery-2.2.3.min.js"></script>
    <!-- script for password match -->
    <script>
        window.onload = function () {
            document.getElementById("password1").onchange = validatePassword;
            document.getElementById("password2").onchange = validatePassword;
        }

        function validatePassword() {
            var pass2 = document.getElementById("password2").value;
            var pass1 = document.getElementById("password1").value;
            if (pass1 != pass2)
                document.getElementById("password2").setCustomValidity("Passwords Don't Match");
            else
                document.getElementById("password2").setCustomValidity('');
            //empty string means no validation error
        }

        //修改找工作的工作列表视图
        function changeJobInDetail(data) {
            var job = data.data;
            if(job == null){
                alert("获取数据异常");
                return false;
            }
            //奇数数列，加头部
            var dom = "<div class='row'><div class='col-sm-12 e-left'><div class='e-desc'><div class='form-group'><label for='recipient-specialty' class='col-form-label'>兼职标题</label><input id='jobName' type='text' class='form-control' value='"+job.jobName+"'></div><div class='form-group'><label for='recipient-specialty' class='col-form-label'>工作简介</label><textarea id='introduction' class='testP form-control'>"+job.introduction+"</textarea></div><hr><ul class='e-tags'>";
            var jobTypes = job.jobType;
            for(var j=0;j<jobTypes.length;j++){
                var jobType = jobTypes[j];
                dom = dom+"<li>"+jobType+"</li>";
            }
            dom = dom +"</ul><hr><ul class='desc-list'><div class='form-group'><li><span>地点:</span><input id='location' type='text' class='form-control' value='"+job.location+"'></li></div><div class='form-group'><li><span>薪资:</span><input id='salary' type='text' class='form-control' value='"+job.salary+"'></li></div><div class='form-group'><li><span>经验:</span><input id='experience' type='text' class='form-control' value='"+job.experience+"'></li></div><li><span>发布时间: </span>"+job.pubTime+"</li><div class='form-group'><li><button class='form-control bg-theme text-uppercase' onclick='changeJob()'>修改</button></li></div></ul></div></div></div>"
            $("#detailJobTest").append(dom);
        }
        //修改申请人列表视图
        function changeApplication(data) {
            var appJobs = data.data;
            if(appJobs == null){
                return false;
            }
            var dom = "<div class='row'><div class='col-lg-12  mx-auto'><div class='e-left pt-lg-5'><div><div class='job-desc-w3ls'><table class='table table-hover'><thead><tr><th>申请人</th><th>电话</th><th>邮箱</th><th>申请时间</th><th>操作</th></tr></thead>";
            for (var i=0;i<appJobs.length;i++){
                var user = appJobs[i].user;
                dom = dom+"<tr><td onclick=\"applicantInfo('"+user.userId+"')\">"+user.userName+"</td><td>"+user.userPhone+"</td><td>"+user.userEmail+"</td><td>"+appJobs[i].appTime+"</td><td><a href='#' onclick=\"agreeJob("+appJobs[i].jobId+",'"+user.userId+"')\" class='my-btn text-capitalize'>同意</a>|<a href='#' onclick=\"rejectJob("+appJobs.jobId+",'"+user.userId+"')\" class='my-btn text-capitalize'>拒绝</a></td></tr>";

            }
            dom = dom +"</table></div></div></div></div></div>";
            console.log(dom);
            $("#application").append(dom);
        }
        function applicantInfo(userId) {
            //跳转至applicantInfo界面
            location.href="http://localhost:8080/applicantInfo?userId="+userId;
        }
        function changeJob() {
            var jobName = $("#jobName").val();
            var introduction = $("#introduction").val();
            var location = $("#location").val();
            var salary = $("#salary").val();
            var experience = $("#experience").val();
            if(jobName == ""||introduction == ""||location == ""||salary == ""||experience == ""){
                alert("数据不能为空");
                return false;
            }
            $.ajax({
                type:"POST",
                contentType:"application/x-www-form-urlencoded",
                url:"http://localhost:8080/job/changeJob",
                data:{
                    "jobName":jobName,
                    "introduction":introduction,
                    "location":location,
                    "salary":salary,
                    "experience":experience,
                },
                success:function (data) {
                    alert(data.msg);
                },
                error:function (data) {
                    alert("请求失败");
                }
            });
            return false;
        }
        function agreeJob(jobId,accId) {

            if(jobId==null||""==jobId||accId==null||""==accId){
                alert("获取信息失败");
                return false;
            }
            var userId = $("#userId").html();
            if(userId==null||""==userId){
                alert("获取用户信息失败");
                return false;
            }
            $.ajax({
                type:"POST",
                contentType:"application/x-www-form-urlencoded",
                url:"http://localhost:8080/job/agreeJob",
                data:{
                    "sendId":userId,
                    "jobId":jobId,
                    "accId":accId,
                },
                success:function (data) {
                    alert(data.msg);
                    if(data.status == 200){
                        location.href="http://localhost:8080/detailsJob?jobId="+jobId;
                    }
                },
                error:function (data) {
                    alert("请求失败");
                }
            });
        }
        function rejectJob(jobId,accId) {
            if(jobId==null||""==jobId||accId==null||""==accId){
                alert("获取信息失败");
                return false;
            }
            var userId = $("#userId").html();
            if(userId==null||""==userId){
                alert("获取用户信息失败");
                return false;
            }
            $.ajax({
                type:"POST",
                contentType:"application/x-www-form-urlencoded",
                url:"http://localhost:8080/job/rejectJob",
                data:{
                    "sendId":userId,
                    "jobId":jobId,
                    "accId":accId,
                },
                success:function (data) {
                    alert(data.msg);
                    if(data.status == 200){
                        location.href="http://localhost:8080/detailsJob?jobId="+jobId;
                    }
                },
                error:function (data) {
                    alert("请求失败");
                }
            });
        }

    </script>
    <!-- script for password match -->
    <script src="js/move-top.js"></script>
    <script src="js/myResponse.js"></script>
    <script src="js/easing.js"></script>
    <script>
        jQuery(document).ready(function ($) {
            $(".scroll").click(function (event) {
                event.preventDefault();

                $('html,body').animate({
                    scrollTop: $(this.hash).offset().top
                }, 1000);
            });
        });

        $.ajax({
            type:"GET",
            url:"http://localhost:8080/job/getJobById",
            success:function (data) {
                if(data.status != 200){
                    alert("获取信息失败");
                }else {
                    changeJobInDetail(data);
                }
            },
            error:function (data) {
                alert("请求失败");
            }
        });
        $.ajax({
            type:"GET",
            url:"http://localhost:8080/job/getAppJobInfo",
            success:function (data) {
                if(data.status != 200){
                    alert("获取申请人员信息失败");
                }else {
                    changeApplication(data);
                }
            },
            error:function (data) {
                alert("请求失败");
            }
        });
    </script>
    <!-- //end-smooth-scrolling -->
    <!-- smooth-scrolling-of-move-up -->
    <script>
        $(document).ready(function () {
            /*
            var defaults = {
                containerID: 'toTop', // fading element id
                containerHoverID: 'toTopHover', // fading element hover id
                scrollSpeed: 1200,
                easingType: 'linear' 
            };
            */

            $().UItoTop({
                easingType: 'easeOutQuart'
            });

        });
    </script>
    <script src="js/SmoothScroll.min.js"></script>
    <!-- //smooth-scrolling-of-move-up -->
    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="js/bootstrap.min.js"></script>
    <script src="js/myResponse.js"></script>
</body>

</html>